* sigsum
** ops
*** deploy a yubihsm to poc [1/3]
DEADLINE: <2024-01-11 Thu> SCHEDULED: <2024-01-09 Tue>
- [X] attached device to logsrv-01 and routed it to poc
- [ ] connector running -- manually created service unit
- [ ] agent running, talking to the connector -- manually created service unit

* st
* tor
** new maatuska on apu2 [0/17]
- [ ] "double sshd setup" to avoid setuid sudo or su
  - [ ] UPDATE <2023-12-30 Sat>: use https://tim.siosm.fr/blog/2023/12/19/ssh-over-unix-socket/
  - [ ] first sshd binding to 0.0.0.0:4722, allowing only linus
    - needs selinux policy change to allow tcp/4722 as well
  - [ ] second sshd binding to 127.0.0.1:22, allowing only root
- [ ] rm all setuid binaries, mount / -o nosuid
- [ ] disable unused services
- [ ] tor installed, maybe from source but maybe not
  - see selinux policy for username and path to binary
  - see systemd.exec(5) for NoNewPrivileges=, SELinuxContext=, Limit*=
    and the whole SANDBOXING section (in particular Protect*=,
    Private*) and the SYSTEM CALL FILTERING section
  - systemd.resource-control(5) might be interesting too    
- [ ] tor keys kept in LUKS container
  - [ ] LUKS key in TPM?
- [ ] bwauth fetcher set up
  - systemd job with timer, separate user and isolated from everything using systemd hardening
    - PrivateTmp=, see see systemd.exec(5)
    - https://www.redhat.com/sysadmin/mastering-systemd has a list
  - post-task kopierar -- ExecStopPost=
  - use seccomp filter for limiting syscalls (f.ex. IoUring, see https://lwn.net/Articles/902466/)
- [ ] unused kernel features disabled, with a sysctl if possible
- [ ] network namespaces configured
  - f.ex.: all services have their own?
- [ ] nftables configured
  - [ ] basics
  - [ ] only root and tor (and the bwauth user) connect out, based on uid
  - [ ] block forward chain
- [ ] cron uninstalled, use systemd timers instead
- [ ] check socket listeners (ss -tulpn)
- [ ] SELinux
  - [ ] remove any modules that are not needed, semodule -r
  - [ ] fix unconfined processes, ps -eFZ | rg unconfined
- [ ] run chrony, not ntpd
- [ ] landlocked requires code changes
  - [ ] feasible for tor?
  - [ ] feasible for sshd?
- [-] TPM chip
  - [X] ordered https://teklager.se/en/products/router-components/APU2_TPM2_module_tpm1a
  - [ ] installed
  - [ ] provisioned
- [ ] IMA, evm -- Integrity Measurement Architecture
  - https://lwn.net/Articles/137306/
  - [ ] can we seal the SSH host key?
  - [ ] can we seal the LUKS passphrase for the LUKS container with tor's keys?
- [ ] ST-booted
  - [ ] from network or local storage?
